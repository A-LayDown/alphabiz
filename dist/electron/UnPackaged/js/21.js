(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[21],{aa3b:function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("q-page",{staticClass:"bg-black overflow-hidden",staticStyle:{height:"calc(100vh - 50px - var(--appbar-height, 0px))!important"}},[s("VideoJsPlayer",{ref:"videoJsPlayer",staticClass:"full-width full-height"})],1)},i=[],r=(s("ddb0"),s("2b3d"),s("9861"),s("5319"),s("77d8")),n=s("41ed"),l=s("0613");const o=s("ed08").isElectron();var c={name:"Player2",mixins:[u(),p(),h(),d(),y(),f()],activated(){console.tag("Player","$route.params").log(this.$route.params)}};function u(){return{data(){return{player:null}},mounted(){this.player=this.$refs.videoJsPlayer.player},methods:{async setSource(e){console.tag("Player","setSource").log(e),await this.player.promiseReady,await this.player.setSource(e)},play(){this.player.play()},async stop(){this.player.states.isPiP&&this.player.setPiP(!1),this.player.states.isFullscreen&&this.player.setFullscreen(!1),await this.player.stop()},pause(e){e&&(this.player.states.isPiP&&this.player.setPiP(!1),this.player.states.isFullscreen&&this.player.setFullscreen(!1)),this.player.states.isPaused||this.player.pause()},setPiP(e){this.player.setPiP(e)},seek(e){this.player.seek(e)},getCurrentSourceData(){var e,t,s,a;const i=null!==(e=null===(t=this.player)||void 0===t||null===(s=t.states.currentSources)||void 0===s||null===(a=s[0])||void 0===a?void 0:a.src)&&void 0!==e?e:null,r=e=>Array.from(new URL(e).searchParams.entries()).reduce(((e,[t,s])=>({...e,[t]:s})),{});if(!i)return null;const n=this.player.states.currentSources[0];return{url:i,params:r(i),infoHash:n.infoHash}}}}}function p(){return{async activated(){var s,a;if("play_source"!==(null===(s=this.$route.params)||void 0===s||null===(a=s.action)||void 0===a?void 0:a.type))return;const i=this.$route.params.action.source;console.tag("Player","mixinSourcePlay").log("src",i.src),i.filename=e(i),i.type=t(i),console.tag("Player","mixinSourcePlay").log("filename",i.filename),console.tag("Player","mixinSourcePlay").log("type",i.type),await this.setSource(i),this.play()}};function e(e){let t;return t=e.src.startsWith("play://")?decodeURI(new URL(e.src).pathname).slice(3):decodeURI(e.src),t}function t(e){return"video/mp4"}}function h(){return{async activated(){var e,t;if("play_file"!==(null===(e=this.$route.params)||void 0===e||null===(t=e.action)||void 0===t?void 0:t.type))return;const s=this.$route.params.action.file;console.tag("Player","mixinFilePlay").log("file",s),await this.setSource({src:URL.createObjectURL(s),type:s.type,file:s}),this.play()}}}function d(){return o||Object(r["a"])()?{async activated(){var t,s;if("play_remote"===(null===(t=this.$route.params)||void 0===t||null===(s=t.action)||void 0===s?void 0:s.type)&&(console.tag("Player","mixinRemotePlay").log("remotePlay",l["a"].state.video.currentVideo.remotePlay),l["a"].state.video.currentVideo.remotePlay)){await l["a"].dispatch("resetRemotePlay");const t=await e.call(this);t&&this.play()}}}:{};async function e(){const e=l["a"].state.video.currentVideo.infoHash,s=this.getCurrentSourceData();if(s&&s.infoHash===e)return;await this.stop();const a=await r.call(this);if(!a)return;const i=o(a,{infoHash:e});try{return await this.setSource(i),await t.call(this,i),!0}catch(c){console.tag("Player","error").error(c)}async function r(){const e=e=>new Promise((t=>setTimeout((()=>t(null)),e))),t=await Promise.race([e(1e4),new Promise((e=>{n["ipcRenderer"].once("stream-address",((t,s)=>e(s))),n["ipcRenderer"].send("get-stream-address")}))]);var s;t?(null!==(s=t.filepath)&&void 0!==s||(t.filepath="win32"===process.platform?decodeURI(t.address).replace("play:///","").replace(/\//g,"\\"):decodeURI(t.address).replace("play://","")),console.tag("Player","streamAddress").log(t)):console.tag("Player","streamAddress").tag.red("timeout").log();return t}function o(e,{infoHash:t}){let s=e.address,a=e.filepath;return s.startsWith("play://")&&(s+=`?infoHash=${t}`,a||(a=decodeURI(new URL(s).pathname).slice(3))),"win32"===process.platform&&(a=a.replace(/\//g,"\\")),{src:s,type:null,filename:a,infoHash:t}}}async function t(e){const{src:t}=e;if(t.startsWith("play://"))return;if(!/wait=0$/gm.test(t))return;const s=l["a"].state.setting.videoCacheTime;if(0===s)return;const a=60*s/this.player.states.duration,i=t.replace(/wait=.*/gm,`wait=${a}`),r=this.player.states.currentTime;await this.setSource(Object.assign(e,{src:i})),this.seek(r)}}function y(){return{beforeRouteLeave(t,s,a){e.call(this),a()},beforeRouteEnter(e,s,a){a((e=>t.call(e)))},mounted(){const e=()=>"Player2"===this.$route.name;this.$watch((()=>{var e;return null===(e=this.player)||void 0===e?void 0:e.states.isPiP}),(t=>{t||this.player.states.isPaused||e()||this.$router.push({name:"Player2"})}))}};function e(){var e,t;this.player&&0!==(null!==(e=null===(t=this.player.states.currentSources)||void 0===t?void 0:t.length)&&void 0!==e?e:0)&&(this.player.states.isPaused||this.player.states.isPiP||"object"!==typeof this.player.states.loadingState&&o&&this.setPiP(!0))}function t(){this.player&&this.player.states.isPiP&&this.setPiP(!1)}}function f(){return{inject:["rootApp","io"],mixins:[e(),t()],mounted(){this.$amplify.addOnAuthStateChangedListener((async e=>{console.tag("Player","PiP","signedOut").log({authState:e}),"signedOut"===e&&await this.pause(!0)}))}};function e(){return{created(){(o||Object(r["a"])())&&n["ipcRenderer"].on("pause-player",(()=>this.pause(!0)))}}}function t(){return{mounted(){this.io.on("server_progress",e.bind(this)),this.io.on("update_subtitleList",t.bind(this)),this.io.on("clear_player",s.bind(this))}};function e(e){var t,s,a,i,r,n;const l=()=>"Player2"===this.$route.name;if(!l())return;const o=null!==(t=null===(s=this.player)||void 0===s||null===(a=s.states.currentSources)||void 0===a||null===(i=a[0])||void 0===i?void 0:i.src)&&void 0!==t?t:null;if(!o)return;const c=null!==(r=null===(n=e.find((e=>o.includes(e.name))))||void 0===n?void 0:n.progress)&&void 0!==r?r:null;function u(e){const t=[],s=e.length;let a=e[0],i=1;for(let r=1;r<s;r++)if(e[r]===a&&r<s-1)i+=1;else{if(e[r+1]===a){i+=1;continue}r===s-1&&(i+=1),i&&t.push({color:1===a?"gold":"transparent",length:i/s*100}),a=e[r],i=1}}c&&u(c)}function t(e,t){console.tag("Player","io$update_subtitleList").log({infoHash:e,subtitleList:t})}async function s({status:e,infoHash:t}){var s,a,i,r;const n=null!==(s=null===(a=this.player)||void 0===a||null===(i=a.states.currentSources)||void 0===i||null===(r=i[0])||void 0===r?void 0:r.src)&&void 0!==s?s:null,l=e=>Array.from(new URL(e).searchParams.entries()).reduce(((e,[t,s])=>({...e,[t]:s})),{});if(!n)return;const{infoHash:o}=l(n);async function c(){await this.stop()}o===t&&(/^play:\/\//gm.test(n)&&"paused"===e||(await c.call(this),await new Promise((e=>setTimeout(e,500))),await this.$router.push({name:"Player2"}),/^http/gm.test(n)&&this.$q.notify(this.$t("stop_stream_player")),/^play:\/\//gm.test(n)&&this.$q.notify(this.$t("stop_player"))))}}}var m=c,P=s("2877"),v=s("9989"),g=s("eebe"),w=s.n(g),b=Object(P["a"])(m,a,i,!1,null,null,null);t["default"]=b.exports;w()(b,"components",{QPage:v["a"]})}}]);